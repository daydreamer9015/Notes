# 데이터베이스 설계서 (Database Design Document)

## 1. 데이터베이스 개요

### 1.1 데이터베이스 정보
| 항목 | 내용 |
|-----|-----|
| DBMS | MySQL 8.0 / Oracle 21c |
| 데이터베이스명 | project_db |
| 문자셋 | UTF-8 |
| 포트 | 3306(MySQL) / 1521 (Oracle) |

### 1.2 명명 규칙
- 테이블명: 소문자, 복수형, snake_case (예: users, boards)
- 컬럼명: 소문자, snake_case (예: user_id, created_at)
- 인덱스명: idx_테이블명_컬럼명
- 외래키명: fk_테이블명_참조테이블명
- Primary Key: 테이블명_id

## 2. ERD (Entity Relationship Diagram)
```
    mermaid
    erDiagram
%% =========================================================
%% 관계 (1:N / N:N)
%% =========================================================
%% USERS(1) - BOARD(N) : 한 사용자는 여러 게시글 작성 가능
USERS ||--o{ BOARDS : writes
%% USERS(1) - COMMENTS(N) : 한 사용자는 여러 댓글 작성 가능
USERS ||--o{ COMMENTS : writes
%% BOARDS(1) - COMMENTS(N) : 한 게시글은 여러 댓글 존재 가능
BOARDS ||--o{ COMMENTS : has
%% BOARDS(1) - ATTACHMENTS(N) : 한 게시글에 여러 첨부파일 존재 가능
BOARDS ||--o{ ATTACHMENTS : has
%% BOARDS(1) - BOARDS_LIKES(N) : 한 게시글에 여러 좋아요 가능
BOARDS ||--o{ BOARDS_LIKES : has
%% USERS(1) - BOARDS_LIKES(N) : 사용자는 여러 게시글에 좋아요 존재
USERS ||--o{ BOARDS_LIKES : likes
%% USERS(1) - USERS_ROLES(N) : 사용자는 여러 역할을 가질 수 있음
USERS ||--o{ USERS_ROLES : has
%% ROLES(1) - USERS_ROLES(N) : 하나의 역할이 여러 사용자에게 부여될 수 있음
ROLES ||--o{ USERS_ROLES : assigned

%% =========================================================
%% 엔티티 : USERS (회원)
%% =========================================================
USERS {
    %% PK: 사용자 고유 식별자
    bigint user_id PK
    %% 로그인 ID로 쓰이는 이메일 (유일해야 함)
    varchar email UK
    %% 패스워드 (해시값 저장 권장)
    varchar password
    %% 화면 표시에 쓰는 이름/닉네임
    varchar username
    %% 전화번호 (+82 -10-1234-5678)
    varchar phone
    %% 계정 상태 : ACTIVE/INACTIVE 등
    varchar status
    %% 생성/수정/마지막 로그인 시각
    timestamp created_at
    timestamp updated_at
    timpstamp last_login_at
}

%% =========================================================
%% 엔티티 : BOARDS (게시글)
%% =========================================================
BOARDS {
    %% PK : 게시글 고유 식별자
    bigint board_id PK
    %% 제목
    varchar title
    %% 본문 내용
    text content
    %% FK : 작성자 (USERS.user_id)
    bigint user_id FK
    %% 카테고리 (공지/질문/자유 등)
    varchar category
    %% 조회수/좋아요 수 (통계성)
    int view_count
    int like_count
    %% 논리 삭제 플래그(물리 삭제 대신 사용)
    boolean is_deleted
    %% 생성/수정 시각
    timestamp created_at
    timestamp upgraded_at
}

%% =========================================================
%% 엔티티 : COMMENTS (댓글/대댓글)
%% =========================================================
COMMENTS {
    %% PK : 댓글 고유 식별자
    bigint comment_id PK
    %% 댓글 내용
    text content
    %% FK : 대상 게시글 (BOARDS.board_id)
    bigint board_id FK
    %% FK : 작성자 (USERS.user_id)
    bigint user_id FK
    %% FK : 부모 댓글(자기 참조) - 대댓글 구현
    bigint parent_id FK
      %% 논리 삭제 플래그(물리 삭제 대신 사용)
    boolean is_deleted
    %% 생성/수정 시각
    timestamp created_at
    timestamp upgraded_at
}

%% =========================================================
%% 엔티티 : ATTACHMENTS (첨부파일)
%% =========================================================
ATTACHMENTS {
    %% PK : 첨부 고유 식별자
    bigint attachment_id PK
    %% 원본 파일명 / 저장 경로 / MIME 타입
    varchar file_name
    varchar file_path
    varchar file_type
    %% 파일 크기(byte)
    bigint file_size
    %% FK : 대상 게시글 (BOARDS.board_id)
    bigint board_id FK
    %% 업로드 시각
    timestamp uploaded_at
}

%% =========================================================
%% 엔티티 : BOARDS_LIKES (좋아요, N:N)
%% =========================================================
BOARDS_LIKES{
    %% PK&FK : 사용자 (USERS.user_id)
    bigint user_id PK
    %% PK&FK : 게시글 (BOARDS.board_id)
    bigint board_id PK
    %% 좋아요 누른 시각
    timestamp created_at 
}

%% =========================================================
%% 엔티티 : ROLES (권한/역할)
%% =========================================================
ROLES {
    %% PK : 역할 고유 식별자
    bigint role_id PK
    %% 유일한 역할명 (예: ADMIN, USER)
    varchar role_name UK
    %% 역할 설명
    varchar description
}

%% =========================================================
%% 엔티티 : USER_ROLES (사용자-역할 매핑)
%% =========================================================
USER_ROLES {
    %% PK&FK : 사용자 (USERS.user_id)
    bigint user_id PK
    %% PK&FK : 역할 (ROLES.role_id)
    bigint role_id PK
    %% 역할 부여 시각
    timestamp assigned_at
}
```

## 3. 테이블 명세서

### 3.1 USERS (사용자)
| 컬럼명 | 데이터타입 | 크기 | NULL | 기본값 | 설명 |
|-------|-------|-------|-------|-------|-------|
| user_id | bigint | - | NO | AUTO_INCREMENT | 사용자 ID(PK) |
| email | varchar | 100 | NO | - | 사용자 이메일(UK) |
| password | varchar | 255 | NO | - | 암호화된 비밀번호 |
| username | varchar | 50 | NO | - | 사용자 이름 |
| phone | varchar | 20 | YES | NULL | 연락처 |
| status | varchar | 20 | NO | 'ACTIVE' | 로그인 상태(ACTIVE/INACTIVE) |
| created_at | timestamp | - | NO | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | timestamp | - | NO | CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 수정일시 |
| last_login_at | timestamp | - | YES | NULL | 최종 로그인 일시 |

### 3.2 BOARDS (게시판)
| 컬럼명 | 데이터타입 | 크기 | NULL | 기본값 | 설명 |
|-------|-------|-------|-------|-------|-------|
| board_id | bigint | - | NO | AUTO_INCREMENT | 게시글 ID(PK) |
| title | varchar | 100 | NO | - | 게시글 제목 |
| content | text | 500 | NO | - | 게시글 내용 |
| user_id | bigint | - | NO | AUTO_INCREMENT | 사용자 ID(FK) |
| category | varchar | 20 | YES | NULL | 카테고리 |
| view_count | int | 20 | YES | 0 | 게시글 조회수 |
| like_count | int | 20 | YES | 0 | 좋아요 수 |
| is_deleted | boolean | - | NO | FALSE | 논리 삭제 |
| created_at | timestamp | - | NO | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | timestamp | - | NO | CURRENT_TIMESTAMP ON UPDATE | 수정일시 |

### 3.3 COMMENTS (댓글/대댓글)
| 컬럼명 | 데이터타입 | 크기 | NULL | 기본값 | 설명 |
|-------|-------|-------|-------|-------|-------|
| comment_id | bigint | - | NO | AUTO_INCREMENT | 댓글 ID(PK) |
| content | text | 100 | NO | - | 댓글 내용 |
| content | text | 500 | NO | - | 대상 게시글(FK) |
| user_id | bigint | - | NO | AUTO_INCREMENT | 작성자(FK) |
| parent_id | bigint | - | YES | NULL | 부모 댓글(FK) |
| is_deleted | boolean | - | NO | FALSE | 논리 삭제 |
| created_at | timestamp | - | NO | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | timestamp | - | NO | CURRENT_TIMESTAMP ON UPDATE | 수정일시 |

COMMENTS {
    %% PK : 댓글 고유 식별자
    bigint comment_id PK
    %% 댓글 내용
    text content
    %% FK : 대상 게시글 (BOARDS.board_id)
    bigint board_id FK
    %% FK : 작성자 (USERS.user_id)
    bigint user_id FK
    %% FK : 부모 댓글(자기 참조) - 대댓글 구현
    bigint parent_id FK
    %% 논리 삭제 플래그(물리 삭제 대신 사용)
    boolean is_deleted
    %% 생성/수정 시각
    timestamp created_at
    timestamp upgraded_at
}

**인덱스**
- Primary Key: user_id
- Unique Key: idx_users_email (email)
### 3.4 ATTACHMENTS (첨부파일)
### 3.5 BOARDS_LIKES (게시글 좋아요)
### 3.6 ROLES (권한)
### 3.7 USERS_ROLES (사용자 권한)

## 4. DDL Scripts

### 4.1 테이블 생성 (MySQL)

```
    SQL

--- 데이터베이스 생성
CREATE DATABASE IF NOT EXISTS product_db
CHARACTER SET utf8mb4

USE product_db;

--- USERS 테이블
CREATE TABLE users (
    user_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    username VARCHAR(50) NOT NULL,
    phone VARCHAR(20),
    status VARCHAR(20) DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    last_login_at TIMESTAMP NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--- BOARD 테이블
--- COMMENTS 테이블
--- ATTACHMENTS 테이블
--- BOARD_LIKES 테이블
--- ROLES 테이블
--- USERS_ROLES 테이블
```

## 5. 샘플 데이터

```
    SQL
```